<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Demand Response Walkthrough · PRAS</title><meta name="title" content="Demand Response Walkthrough · PRAS"/><meta property="og:title" content="Demand Response Walkthrough · PRAS"/><meta property="twitter:title" content="Demand Response Walkthrough · PRAS"/><meta name="description" content="Documentation for PRAS."/><meta property="og:description" content="Documentation for PRAS."/><meta property="twitter:description" content="Documentation for PRAS."/><meta property="og:url" content="https://nrel.github.io/PRAS/stable/examples/demand_response_walkthrough/"/><meta property="twitter:url" content="https://nrel.github.io/PRAS/stable/examples/demand_response_walkthrough/"/><link rel="canonical" href="https://nrel.github.io/PRAS/stable/examples/demand_response_walkthrough/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PRAS</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../resourceadequacy/">Resource Adequacy</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../installation/">Installation</a></li><li><a class="tocitem" href="../../quickstart/">Quick Start</a></li></ul></li><li><span class="tocitem">PRAS Components </span><ul><li><a class="tocitem" href="../../PRAS/sysmodelspec/">System Model Specification</a></li><li><a class="tocitem" href="../../PRAS/simulations/">Simulation Specifications</a></li><li><a class="tocitem" href="../../PRAS/results/">Result Specifications</a></li><li><a class="tocitem" href="../../PRAS/capacitycredit/">Capacity Credit Calculation</a></li></ul></li><li><a class="tocitem" href="../../SystemModel_HDF5_spec/">.pras File Format</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../pras_walkthrough/">PRAS 101 Walkthrough</a></li><li class="is-active"><a class="tocitem" href>Demand Response Walkthrough</a><ul class="internal"><li><a class="tocitem" href="#Add-Demand-Response-to-the-SystemModel"><span>Add Demand Response to the SystemModel</span></a></li><li><a class="tocitem" href="#Run-a-Sequential-Monte-Carlo-Simulation-with-and-without-Demand-Response"><span>Run a Sequential Monte Carlo Simulation with and without Demand Response</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../extending/">Extending PRAS</a></li><li><a class="tocitem" href="../../changelog/">Changelog</a></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../../PRASCore/api/">PRASCore</a></li><li><a class="tocitem" href="../../PRASFiles/api/">PRASFiles</a></li><li><a class="tocitem" href="../../PRASCapacityCredits/api/">PRASCapacityCredits</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Demand Response Walkthrough</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Demand Response Walkthrough</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/NREL/PRAS" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/NREL/PRAS/blob/main/PRAS.jl/examples/demand_response_walkthrough.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="demand_response_walkthrough"><a class="docs-heading-anchor" href="#demand_response_walkthrough">Demand Response Walkthrough</a><a id="demand_response_walkthrough-1"></a><a class="docs-heading-anchor-permalink" href="#demand_response_walkthrough" title="Permalink"></a></h1><p>This is a complete example of adding demand response to a system, using the <a href="https://github.com/GridMod/RTS-GMLC">RTS-GMLC</a> system</p><p>Load the PRAS package and other tools necessary for analysis</p><pre><code class="language-julia hljs">using PRAS
using Plots
using DataFrames
using Dates
using Measures</code></pre><h2 id="Add-Demand-Response-to-the-SystemModel"><a class="docs-heading-anchor" href="#Add-Demand-Response-to-the-SystemModel">Add Demand Response to the SystemModel</a><a id="Add-Demand-Response-to-the-SystemModel-1"></a><a class="docs-heading-anchor-permalink" href="#Add-Demand-Response-to-the-SystemModel" title="Permalink"></a></h2><p>For the purposes of this example, we&#39;ll just use the built-in RTS-GMLC model. For further information on loading in systems and exploring please see the <a href="../pras_walkthrough/#pras_walkthrough">PRAS walkthrough</a>.</p><pre><code class="language-julia hljs">rts_gmlc_sys = PRAS.rts_gmlc();</code></pre><p>Lets overview the system information and make sure the demand response we are creating is correct unit wise.</p><pre><code class="language-julia hljs">rts_gmlc_sys</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PRAS system with 3 regions, and 3 interfaces between these regions.
Region names: 1, 2, 3

Assets: 
  Generators: 153 units
  Storages: 1 units
  GeneratorStorages: 1 units
  DemandResponses: 0 units
  Lines: 6

Time series:
  Start time: 2020-01-01T00:00:00+00:00
  Resolution: 1 Hour
  Number of time steps: 8784
  End time: 2020-12-31T23:00:00+00:00
  Time zone: UTC
</code></pre><p>First, we  define our new demand response component. In accordance with the broader system the component will have a simulation length of 8784 timesteps, hourly interval, and MW/MWh power/energy units. We will then have a single demand response resource of type <code>&quot;DR_TYPE1&quot;</code> with a 50 MW borrow and payback capacity, 200 MWh energy capacity, 0% borrowed energy interest, 6 hour allowable payback time periods, 10% outage probability, and 90% recovery probability. The setup below uses the <code>fill</code> function to create matrices with the correct dimensions for each of the parameters, which can be extended to multiple demand response resources by changing the <code>number_of_drs</code> variable and adjusting names and types accordingly.</p><pre><code class="language-julia hljs">(timesteps,periodlen,periodunit,powerunit,energyunit) = get_params(rts_gmlc_sys);
number_of_drs = 1;
new_drs = DemandResponses{timesteps,periodlen,periodunit,powerunit,energyunit}(
    [&quot;DR1&quot;],
    [&quot;DR_TYPE1&quot;],
    fill(50, number_of_drs, timesteps),   # borrow power capacity
    fill(50, number_of_drs, timesteps),   # payback power capacity
    fill(200, number_of_drs, timesteps),  # load energy capacity
    fill(0.0, number_of_drs, timesteps),  # 0% borrowed energy interest
    fill(6, number_of_drs, timesteps),    # 6 hour allowable payback time periods
    fill(0.1, number_of_drs, timesteps),  # 10% outage probability
    fill(0.9, number_of_drs, timesteps),  # 90% recovery probability
    );</code></pre><p>We will also assign the demand response to region &quot;2&quot; of the system.</p><pre><code class="language-julia hljs">dr_region_indices = [1:0,1:1,2:0];</code></pre><p>We also want to increase the load in the system to see the effect of demand response being utilized. We do this by creating a new load matrix that is 25% higher than the original load.</p><pre><code class="language-julia hljs">updated_load = Int.(round.(rts_gmlc_sys.regions.load .* 1.25));</code></pre><p>Lets define our new regions with the updated load.</p><pre><code class="language-julia hljs">new_regions = Regions{timesteps,powerunit}([&quot;1&quot;,&quot;2&quot;,&quot;3&quot;],updated_load);</code></pre><p>Finally, we create two new system models, one with dr and one without.</p><pre><code class="language-julia hljs">modified_rts_with_dr  = SystemModel(
    new_regions, rts_gmlc_sys.interfaces,
    rts_gmlc_sys.generators, rts_gmlc_sys.region_gen_idxs,
    rts_gmlc_sys.storages, rts_gmlc_sys.region_stor_idxs,
    rts_gmlc_sys.generatorstorages, rts_gmlc_sys.region_genstor_idxs,
    new_drs, dr_region_indices,
    rts_gmlc_sys.lines, rts_gmlc_sys.interface_line_idxs,
    rts_gmlc_sys.timestamps);

modified_rts_without_dr  = SystemModel(
    new_regions, rts_gmlc_sys.interfaces,
    rts_gmlc_sys.generators, rts_gmlc_sys.region_gen_idxs,
    rts_gmlc_sys.storages, rts_gmlc_sys.region_stor_idxs,
    rts_gmlc_sys.generatorstorages, rts_gmlc_sys.region_genstor_idxs,
    rts_gmlc_sys.lines, rts_gmlc_sys.interface_line_idxs,
    rts_gmlc_sys.timestamps);</code></pre><p>For validation, we can check that one new demand response device is in the system, and the other system has none.</p><pre><code class="language-julia hljs">println(&quot;System with DR\n &quot;,modified_rts_with_dr.demandresponses)
println(&quot;\nSystem without DR\n &quot;,modified_rts_without_dr.demandresponses)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">System with DR
 1 DemandResponses:
  Category   | Count
  --------------------
  DR_TYPE1   | 1


System without DR
 0 DemandResponses:
  Category   | Count
  --------------------</code></pre><h2 id="Run-a-Sequential-Monte-Carlo-Simulation-with-and-without-Demand-Response"><a class="docs-heading-anchor" href="#Run-a-Sequential-Monte-Carlo-Simulation-with-and-without-Demand-Response">Run a Sequential Monte Carlo Simulation with and without Demand Response</a><a id="Run-a-Sequential-Monte-Carlo-Simulation-with-and-without-Demand-Response-1"></a><a class="docs-heading-anchor-permalink" href="#Run-a-Sequential-Monte-Carlo-Simulation-with-and-without-Demand-Response" title="Permalink"></a></h2><p>We can now run a sequential monte carlo simulation with and without the demand response to see the effect it has on the system. We will query the shortfall attributable to demand response (load that was borrowed and never able to be paid back) and total system shortfall.</p><pre><code class="language-julia hljs">simspec = SequentialMonteCarlo(samples=100, seed=112);
resultspecs =   (Shortfall(),DemandResponseShortfall(),DemandResponseEnergy());


shortfall_with_dr, dr_shortfall_with_dr,dr_energy_with_dr = assess(modified_rts_with_dr, simspec, resultspecs...);
shortfall_without_dr, dr_shortfall_without_dr,dr_energy_without_dr = assess(modified_rts_without_dr, simspec, resultspecs...);</code></pre><p>Querying the results, we can see that total system shortfall is lower with demand response, across EUE and LOLE metrics.</p><pre><code class="language-julia hljs">println(&quot;LOLE Shortfall with DR: &quot;, LOLE(shortfall_with_dr))
println(&quot;LOLE Shortfall without DR: &quot;, LOLE(shortfall_without_dr))

println(&quot;\nEUE Shortfall with DR: &quot;, EUE(shortfall_with_dr))
println(&quot;EUE Shortfall without DR: &quot;, EUE(shortfall_without_dr))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">LOLE Shortfall with DR: LOLE = 23±1 event-h/8784h
LOLE Shortfall without DR: LOLE = 27±1 event-h/8784h

EUE Shortfall with DR: EUE = 5900±500 MWh/8784h
EUE Shortfall without DR: EUE = 6900±600 MWh/8784h</code></pre><p>We can also collect the same reliability metrics with the demand response shortfall, which is the amount of load that was borrowed and never able to be paid back.</p><pre><code class="language-julia hljs">println(&quot;EUE Demand Response Shortfall: &quot;, EUE(dr_shortfall_with_dr))
println(&quot;LOLE Demand Response Shortfall: &quot;, LOLE(dr_shortfall_with_dr))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">EUE Demand Response Shortfall: EUE = 250±30 MWh/8784h
LOLE Demand Response Shortfall: LOLE = 2.1±0.2 event-h/8784h</code></pre><p>This means over the simulation, load borrowed and unable to be paid back was 250MWh plus or minus 30 MWh. Similarly, we have a loss of load expectation from demand response of 2.1 event hours per year.</p><p>Lets plot the borrowed load of the demand response device over the simulation.</p><pre><code class="language-julia hljs">borrowed_load = [x[1] for x in dr_energy_with_dr[&quot;DR1&quot;,:]];
plot(rts_gmlc_sys.timestamps, borrowed_load, xlabel=&quot;Timestamp&quot;, ylabel=&quot;DR1 Borrowed Load&quot;, title=&quot;DR1 Borrowed Load vs Time&quot;, label=&quot;&quot;)</code></pre><img src="09eae728.svg" alt="Example block output"/><p>We can see that the demand response device was utilized during the summer months, however never borrowing up to its full 200MWh capacity.</p><p>Lets plot the demand response borrowed load across the month and hour of day for greater granularity on when load is being borrowed.</p><pre><code class="language-julia hljs">months = month.(rts_gmlc_sys.timestamps);
hours = hour.(rts_gmlc_sys.timestamps) .+ 1;

heatmap_matrix = zeros(Float64, 24, 12);
for (val, m, h) in zip(borrowed_load, months, hours)
    heatmap_matrix[h, m] += val;
end

heatmap(
    1:12, 0:23, heatmap_matrix;
    xlabel=&quot;Month&quot;, ylabel=&quot;Hour of Day&quot;, title=&quot;Total DR1 Borrowed Load (MWh)&quot;,
    xticks=(1:12, [&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;]),
    colorbar_title=&quot;Borrowed Load&quot;, color=cgrad([:white, :red], scale = :linear),
    left_margin = 5mm, right_margin = 5mm
)</code></pre><img src="8c0fb958.svg" alt="Example block output"/><p>Maximum borrowed load occurs in the late afternoon July month, with a different peaking pattern as greater surplus exists in August, with reduced load constraints.</p><p>We can also back calculate the borrow power and payback power, by calculating timestep to timestep differences. Note, payback power here will not capture any dr attributable shortfall or the impact of <code>borrowed_energy_interest</code>.</p><pre><code class="language-julia hljs">borrow_power = zeros(Float64, timesteps);
payback_power= zeros(Float64, timesteps);
borrow_power = max.(0.0, borrowed_load[2:end] .- borrowed_load[1:end-1]);
payback_power = max.(0.0, borrowed_load[1:end-1] .- borrowed_load[2:end]);</code></pre><p>And then plotting the two heatmaps to identify when key borrowing and payback periods are occuring.</p><pre><code class="language-julia hljs">borrow_heatmap = zeros(Float64, 24, 12)
payback_heatmap = zeros(Float64, 24, 12)

for (b, p, m, h) in zip(borrow_power, payback_power, months[2:end], hours[2:end])
    borrow_heatmap[h, m] += b
    payback_heatmap[h, m] += p
end

p1 = heatmap(1:12, 0:23, borrow_heatmap; ylabel = &quot;Hour of Day&quot;, title=&quot;DR1 Borrow&quot;,
    xticks=(1:12, [&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;]),
    xtickfont=font(7),
    colorbar_title=&quot;Borrow (MW)&quot;, color=cgrad([:white, :red]),
    left_margin = 5mm, right_margin = 3mm);
p2 = heatmap(1:12, 0:23, payback_heatmap; ylabel = &quot;Hour of Day&quot;, title=&quot;DR1 Payback&quot;,
    xticks=(1:12, [&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;]),
    xtickfont=font(7),
    colorbar_title=&quot;Payback (MW)&quot;, color=cgrad([:white, :blue]),
    left_margin = 3mm, right_margin = 5mm);

plot(p1, p2; layout=(1,2), size=(1000, 500), link = :all)</code></pre><img src="5894b6e1.svg" alt="Example block output"/><p>We can see peak borrowing occurs around 4-6pm, shifting earlier in the following month, with payback, occurring almost immediately after borrowing, peaking around 7-9pm in July.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../pras_walkthrough/">« PRAS 101 Walkthrough</a><a class="docs-footer-nextpage" href="../../extending/">Extending PRAS »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Friday 17 October 2025 21:15">Friday 17 October 2025</span>. Using Julia version 1.12.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
